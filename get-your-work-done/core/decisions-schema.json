{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GYWD Decision Graph Schema",
  "description": "Schema for storing and linking codebase decisions",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "const": "2.0.0"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "project": { "type": "string" },
        "extracted_at": { "type": "string", "format": "date-time" },
        "extraction_depth": { "enum": ["quick", "standard", "deep"] },
        "commit_range": {
          "type": "object",
          "properties": {
            "from": { "type": "string" },
            "to": { "type": "string" },
            "count": { "type": "integer" }
          }
        }
      }
    },
    "decisions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Decision"
      }
    },
    "links": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/DecisionLink"
      }
    },
    "conflicts": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Conflict"
      }
    },
    "indexes": {
      "type": "object",
      "properties": {
        "by_file": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "by_author": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "by_tag": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    }
  },
  "definitions": {
    "Decision": {
      "type": "object",
      "required": ["id", "type", "summary", "confidence"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^DEC-[0-9]{3,}$",
          "description": "Unique decision identifier"
        },
        "type": {
          "enum": ["architectural", "convention", "constraint", "trade-off", "tactical"],
          "description": "Category of decision"
        },
        "summary": {
          "type": "string",
          "description": "One-line summary of the decision"
        },
        "rationale": {
          "type": "string",
          "description": "Why this decision was made"
        },
        "alternatives_considered": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "option": { "type": "string" },
              "reason_rejected": { "type": "string" }
            }
          }
        },
        "trade_offs": {
          "type": "object",
          "properties": {
            "gained": { "type": "array", "items": { "type": "string" } },
            "sacrificed": { "type": "array", "items": { "type": "string" } }
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Confidence score (0-100%)"
        },
        "source": {
          "type": "object",
          "properties": {
            "type": {
              "enum": ["explicit", "inferred"],
              "description": "Whether decision was explicitly documented or inferred"
            },
            "evidence": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": { "enum": ["commit", "pr", "comment", "doc", "pattern"] },
                  "ref": { "type": "string" },
                  "excerpt": { "type": "string" }
                }
              }
            }
          }
        },
        "scope": {
          "type": "object",
          "properties": {
            "files": { "type": "array", "items": { "type": "string" } },
            "directories": { "type": "array", "items": { "type": "string" } },
            "global": { "type": "boolean" }
          }
        },
        "author": { "type": "string" },
        "date": { "type": "string", "format": "date" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "status": {
          "enum": ["active", "superseded", "deprecated", "questioned"],
          "default": "active"
        },
        "superseded_by": { "type": "string" }
      }
    },
    "DecisionLink": {
      "type": "object",
      "required": ["from", "to", "relationship"],
      "properties": {
        "from": { "type": "string" },
        "to": { "type": "string" },
        "relationship": {
          "enum": ["led_to", "constrains", "conflicts_with", "supersedes", "enables", "depends_on"]
        },
        "description": { "type": "string" }
      }
    },
    "Conflict": {
      "type": "object",
      "required": ["decisions", "nature"],
      "properties": {
        "decisions": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 2
        },
        "nature": {
          "type": "string",
          "description": "Description of the conflict"
        },
        "severity": {
          "enum": ["low", "medium", "high"],
          "default": "medium"
        },
        "resolution_suggestion": { "type": "string" },
        "resolved": { "type": "boolean", "default": false }
      }
    }
  }
}
